#!/bin/bash
# Run tests for the algorithmic trading system

# Get the directory of this script
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

# Make sure we're in the project root directory
cd "$SCRIPT_DIR"

# Create necessary __init__.py files if they don't exist
echo "Ensuring all test directories have __init__.py files..."
mkdir -p tests/unit/core
mkdir -p tests/unit/data
mkdir -p tests/integration

for dir in tests tests/unit tests/unit/core tests/unit/data tests/integration; do
    if [ ! -f "$dir/__init__.py" ]; then
        echo "Creating $dir/__init__.py"
        touch "$dir/__init__.py"
    fi
done

# Check if we want to run specific tests
if [ "$1" == "core" ]; then
    # Run core event system tests
    echo "Running core event system tests..."
    python -m unittest tests.unit.core.test_events
    python -m unittest tests.unit.core.test_async_events
elif [ "$1" == "data" ]; then
    # Run data module tests
    echo "Running data module tests..."
    python -m unittest discover tests/unit/data
elif [ "$1" == "integration" ]; then
    # Run integration tests
    echo "Running integration tests..."
    python -m unittest discover tests/integration
else
    # Run all tests
    echo "Running all tests..."
    python -m unittest discover tests
fi

echo "All tests completed."
